{{#*inline "folderPartial"}}
<li class="directory-item folder flexcol {{#unless folder.expanded}}collapsed{{/unless}}"
    data-folder-id="{{folder._id}}" data-folder-depth="{{folder.depth}}">
    <header class="folder-header flexrow" style="background-color: {{folder.data.color}}">
        <h3><i class="fas fa-folder-open fa-fw"></i>{{folder.name}}</h3>
        {{#if user.isGM}}
        <a class="create-folder" data-parent-folder="{{folder._id}}"><i class="fas fa-folder-plus fa-fw"></i></a>
        <a class="create-entity" data-folder="{{folder._id}}"><i class="fas fa-feather-alt fa-fw"></i></a>
        {{/if}}
    </header>

    <ol class="subdirectory">
        {{~#each folder.children as |child i|}}
        {{> folderPartial folder=child user=../user}}
        {{/each}}
        {{#each folder.content}}
        {{> entityPartial}}
        {{/each~}}
    </ol>
</li>
{{/inline}}

{{#*inline "entityPartial"}}
<li class="directory-item entity journal flexrow" data-entity-id="{{this._id}}">
    <h4 class="entity-name"><a>{{this.name}}</a></h4>
</li>
{{/inline}}

<div class="monks-enhanced-journal flexrow">
    <div class="body flexcol">
        <div class="mainbar flexcol">
            <div class="tab-bar flexrow">
                <div class="tab-row flexrow">
                    {{#each tabs}}
                    <div class="journal-tab{{#if this.active}} active{{/if}}" title="{{this.text}}" data-tabid="{{this.id}}">
                        <div class="tab-content"><span>{{this.text}}</span><div class="close"><i class="fas fa-times"></i></div></div>
                    </div>
                    {{/each}}
                    <div class="tab-button tab-add"><i class="fas fa-plus"></i></div>
                </div>
            </div>
            <div class="bookmark-bar flexrow">
                <div class="bookmark-button add-bookmark" title="Add Bookmark"><i class="fas fa-star"></i></div>
                {{#each bookmarks}}
                <div class="bookmark-button" title="{{this.text}}" data-bookmark-id="{{this.id}}" data-entity-id="{{this.entityId}}"><div><i class="fas {{this.icon}}"></i> {{this.text}}</div></div>
                {{/each}}
            </div>
            <div class="navigation flexrow">
                <div class="nav-button back-button" title="Back" data-history="back"><i class="fas fa-chevron-left"></i></div>
                <div class="nav-button forward-button disabled" title="Forward" data-history="forward"><i class="fas fa-chevron-right"></i></div>
                <div class="button-group flexrow" id="journal-buttons">
                    <div class="nav-button search" title="Search"><i class="fas fa-search"></i><input class="search" type="text" name="search-entry" autocomplete="off" /></div>
                    <div class="nav-button show" title="Show Players"><i class="fas fa-eye"></i></div>
                    <div class="nav-button edit" title="Edit"><i class="fas fa-pencil-alt"></i></div>
                </div>
            </div>
        </div>
        <div class="content">
            <form class="flexcol editable" autocomplete="off">
                {{{content}}}
            </form>
        </div>
    </div>
    <div class="sidebar">
        <section class="sidebar-tab sidebar-directory tab flexcol" id="journal-directory" data-tab="journal">

            <!-- Directory Header -->
            <header class="directory-header">
                <div class="header-actions action-buttons flexrow">
                    {{#if canCreate}}
                    <button class="create-entity"><i class="fas fa-feather"></i> {{localize 'JOURNAL.Create'}}</button>
                    {{/if}}
                    {{#if user.isGM }}
                    <button class="create-folder"><i class="fas fa-folder"></i> {{localize 'FOLDER.Create'}}</button>
                    {{/if}}
                </div>
                <div class="header-search flexrow">
                    <i class="fas fa-search"></i>
                    <input type="text" name="search" value="" placeholder="{{localize 'JOURNAL.Search'}}" autocomplete="off" />
                    <a class="header-control collapse-all" title="{{localize 'FOLDER.Collapse'}}"><i class="fas fa-sort-amount-up fa-fw"></i></a>
                </div>
            </header>

            <!-- Directories List -->
            <ol class="directory-list">
                {{~#each tree.children as |f fi|}}
                {{> folderPartial folder=f user=../user}}
                {{/each}}
                {{#each tree.content}}
                {{> entityPartial}}
                {{/each~}}
            </ol>

            <!-- Directory Footer -->
            <footer class="directory-footer"></footer>
        </section>
    </div>
</div>